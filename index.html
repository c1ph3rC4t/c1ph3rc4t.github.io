<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CSS text glow test</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap');

    body {
      background-color: black;
      font-family: "Fira Code", Courier, monospace;
      letter-spacing: normal;
      word-spacing: normal;
    }

    .glow {
      font-size: 15px;
      color: #ffaaee;
      font-family: "Fira Code";
      text-shadow: 0px 0px 75px #ffbbee, 0px 0px 25px #ffbbee, 0px 0px 200px #fff;
      white-space: pre;
    }
  </style>
</head>

<body>
  <pre class="glow" id="glow-text"></pre>
  <script>
    let inputString = '';
    let terminal = '';
    const username = 'c1ph3rC4t';
    const device = 'website';
    let free = true;
    const cmds = [];

      // Fetch command list from GitHub API
      const fetchCmds = async () => {
        try {
          const response = await fetch('https://api.github.com/repos/c1ph3rC4t/c1ph3rc4t.github.io/contents/cmds');
          if (response.ok) {
            const files = await response.json();
            files.forEach(file => {
              if (file.type === 'file' && file.name.endsWith('.js')) {
                cmds.push(file.name.replace('.js', ''));
              }
            });
            console.log('Fetched cmds:', cmds);
          } else {
            console.error('Failed to fetch command list:', response.status, response.statusText);
          }
        } catch (error) {
          console.error('Fetch error:', error);
        }
      };

      fetchCmds();

    const readFileSync = (filePath) => {
        const xhr = new XMLHttpRequest();
        xhr.open('GET', filePath, false);
        try {
            xhr.send();
            if (xhr.status === 200) {
                return xhr.responseText;
            } else {
                console.error('Error fetching file:', xhr.statusText);
                return null;
            }
        } catch (error) {
            console.error('Request failed:', error);
            return null;
        }
    };

    const parseCmd = (cmd) => {
        const parts = cmd.split(' ');
        const result = { cmd: parts[0], args: {} };
        let currentFlag = '';

        for (let i = 1; i < parts.length; i++) {
            if (parts[i].startsWith('--')) {
                currentFlag = parts[i].substring(2);
                result.args[currentFlag] = '';
            } else if (parts[i].startsWith('-')) {
                currentFlag = parts[i].substring(1);
                result.args[currentFlag] = '';
            } else if (currentFlag) {
                result.args[currentFlag] = parts[i];
                currentFlag = '';
            } else {
                if (!result.args['']) {
                    result.args[''] = parts[i];
                } else {
                    result.args[''] += ' ' + parts[i];
                }
            }
        }

        return result;
    };

    const run = (cmd) => {
      cmd = parseCmd(cmd)
      if (cmds.includes(cmd.cmd)) {
        eval(readFileSync(`./cmds/${cmd.cmd}.js`))
      } else {
        print(`Error cmd '${cmd.cmd}' not found.`)
      }
    }

    const print = (text) => {
      terminal += `${text}\n`
    }

    document.addEventListener('keydown', (event) => {
      if (free) {
        if (event.key === 'Backspace') {
          inputString = inputString.slice(0, -1);
        } else if (event.key === 'Enter') {
          print(`${username}@${device}:~$ ${inputString}`);
          run(inputString);
          inputString = '';
        } else if (event.key.length === 1) {
          inputString += event.key;
        } else {
          console.log('WTF is:', event.key);
        }
      }
    });

    const getInputString = () => {
      return inputString;
    }

    const update = () => {
      const userInput = getInputString();
      const userText = `${username}@${device}:~$ ${userInput}\n`;

      if (free) {
        document.getElementById('glow-text').textContent = terminal + userText;
      } else {
        inputString = ''
        document.getElementById('glow-text').textContent = terminal;
      }

      requestAnimationFrame(update);
    }

    update();
  </script>
</body>

</html>
